(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4611"],{"8ioA":function(e,t,n){},BNNy:function(e,t,n){"use strict";var i=function(e,t,n,i){return{pattern:"string"==typeof e?new RegExp(e,i):e,message:t||"输入格式不匹配",trigger:n||"change"}},r=function(e,t,n,r){return i("^.{"+e+","+t+"}$",n,"change",r)},a=function(e,t,n){return i("^[0-9]{"+e+","+t+"}$",n)},s=function(e,t,n,i){return{validator:function(i,r,a){""===r&&a(),r+="";var s=parseInt(r);r.length===(s+"").length&&e<=s&&s<=t?a():a(new Error(n||$.tpl("请输入{min} ~ {max}范围内的整数",{min:e,max:t})))},trigger:i||"change"}},o=function(e){return $.tpl("限制{size}位字符输入",{size:e})},d=function(e){return $.tpl("仅支持数字输入，限制最大输入{size}位字符，最小为1位字符",{size:e})},l=/^[0-9]{20}$/,u=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$|^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,c={validator:function(e,t,n){""===t&&n(),l.test(t)?n():u.test(t)?n():n(new Error("IP地址格式不正确"))},trigger:"change"},f=/^((25[0-5]|2[0-4]\d|[01]?\d\d?)($|(?!\.$)\.)){4}$|^((25[0-5]|2[0-4]\d|[01]?\d\d?)($|(?!\.$)\.)){3}\*$|^((25[0-5]|2[0-4]\d|[01]?\d\d?)($|(?!\.$)\.)){2}\*\.((25[0-5]|2[0-4]\d|[01]?\d\d?))$|^((25[0-5]|2[0-4]\d|[01]?\d\d?)($|(?!\.$)\.)){2}\*\.\*$|^((25[0-5]|2[0-4]\d|[01]?\d\d?)($|(?!\.$)\.)){3}((25[0-5]|2[0-4]\d|[01]?\d\d?))\-((25[0-5]|2[0-4]\d|[01]?\d\d?))$/,m={validator:function(e,t,n){""===t&&n();for(var i=t.trim().split(/,|，/),r=0,a=0;a<i.length;a++)f.test(i[a])||r++;r>0?n(new Error("IP格式错误")):n()},trigger:"change"},p=r(1,16,o(16)),h=r(1,18,o(18)),g=r(1,20,o(20)),v=r(1,24,o(24)),b=r(1,25,o(25)),F=r(1,32,o(32)),w=r(1,36,o(36)),y=r(1,40,o(40)),I=r(1,45,o(45)),A=r(1,50,o(50)),j=r(1,64,o(64)),x=r(1,80,o(80)),T=r(1,100,o(100)),E=r(1,128,o(128),"m"),S=r(1,150,o(150)),_=r(1,250,o(250)),C=r(1,1e3,o(1e3)),k=r(1,1500,o(1500)),z=r(1,45,o(45)),N=function(e,t,n,r){return i("^[a-zA-Z0-9/_-]{"+e+","+t+"}$",n,"change",r)}(1,64,"仅允许输入字母、数字、下划线、中线、以及 / 输入，长度范围 1 ~ 64 位"),D=a(1,4,d(4)),R=a(1,5,d(5)),O=a(1,6,d(6)),U=a(1,10,d(10)),L=a(1,11,d(11)),V=a(1,18,d(18)),q=a(1,20,d(20)),P=a(1,24,d(24)),Z=a(1,25,d(25)),B=a(1,32,d(32)),K=a(1,36,d(36)),W=a(1,50,d(50)),G=a(1,64,d(64)),M=s(5,20),X=s(1,99),J=s(1,100),Q=s(0,128),Y=s(1,512),H=s(1,999),ee=s(1,1e3),te=s(1,3e3),ne=s(1,3600),ie=s(1,9999),re=s(1,99999),ae=s(5,60,"可输入5-60中的任何数字"),se=i("^(([1-9]{1}[0-9]{0,6}))$","可输入1—9999999中的任何数字"),oe=i("^(([1-9]{1}[0-9]{0,5}))$","可输入1—999999中的任何数字"),de=i(/^(([^<>()[\]\\.,;:\s@\\"]+(\.[^<>()[\]\\.,;:\s@\\"]+)*)|(\\".+\\"))@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,"邮箱格式不正确"),le=i("^(([1-9]{1}[0-9]{0,3})|10000|0)$","可输入0—10000中的任何数字，0的级别最小，10000的级别最大"),ue=i("^(([1-9]\\d{0,4})|0)(\\.\\d{1,2})?$","支持数字输入，支持小数点后2位，最大支持小数点前4位数字输入，最大9999G"),ce=i("^[^&#\\s一-龥]{1,30}$","支持1 ~ 30位，除了中文、 空格、' & '、 '#' 以外的字符输入"),fe=i("^[a-zA-Z0-9_]{1,30}$","密码由数字、字母、下划线组成，长度为1~30位"),me=i(/^[0-9]{1,20}$/,"请输入1~20位长度的数字"),pe=i(/^\d{13}$|^\d{20}$/,"请输入13或20位长度的数字"),he=i(/^\d{1,20}$/,"请输入1~20位长度的数字"),ge=i(/^[1-9]\d*$/,"仅支持输入非零整数"),ve=i(/^[1-9]\d?$|^100$/,"仅支持输入非零整数, 数字范围1~100"),be=s(0,1e3,"仅支持数字输入，默认为4，不输入数字则不做限制，最大可设1000路"),$e=i(/^[0-9\\-]{1,20}$/,"电话号码格式不正确,例如 010-82325561, 支持20位输入"),Fe=i(u,"IP地址格式不正确"),we=s(1,65535,"端口号请输入1到65535的整数"),ye=i("^(([1-9]{1}[0-9]{0,4}))$|^[0-9]{20}$","可输入1—99999中的任何数字，或20位的国标编号"),Ie=i("^(([1-9]{1}[0-9]{0,4}))$","可输入1—99999中的任何数字"),Ae=i("^(([1-9]\\d{0,19})|0)(\\.\\d{1,2})?$","支持20位数字，精确到小数点后俩位"),je=i("^(([1-9]{1}[0-9]{0,2}))$|^1000$","可输入1—1000中的任何数字"),xe=i("^([1-9]{1}[0-9]{0,2})$|^([1-2]{1})([0-9]{0,3})$|^3000$","可输入1—3000中的任何数字"),Te=i("^-?(?:(?:180(?:\\.0{1,16})?)|(?:(?:(?:1[0-7]\\d)|(?:[1-9]?\\d))(?:\\.\\d{1,16})?))$","经度范围：-180~180，精确到小数点后16位"),Ee=i("^-?(?:90(?:\\.0{1,16})?|(?:[1-8]?\\d(?:\\.\\d{1,16})?))$","纬度范围：-90~90，精确到小数点后16位"),Se=i("^(([1-9]{1}[0-9]{0,3}))$","可输入1—9999中的任何数字"),_e=i("^(([1-9]\\d{0,9})|0)(\\.\\d{1,2})?$","支持10位数字，精确到小数点后俩位"),Ce=i("^([1-9]\\d{0,4})?$","最大支持5位数字输入"),ke=i("^([1-9]\\d{0,7})?$","最大支持8位数字输入"),ze=i("^([0-9a-fA-F]{2}[:-]){5}([0-9a-fA-F]{2})$","MAC地址格式不正确,格式如: 00:A3:19:EF:E4:24"),Ne=i(function(){var e="http, https, ftp".split(",").join("|").replace(/\s/g,"");return new RegExp("^(?:(?:"+e+")://)?(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-?)*[a-z\\u00a1-\\uffff0-9])*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))?)(?::\\d{2,5})?(?:/[^\\s]*)?$","i")}()),De={validator:function(e,t,n){""===t&&n();var i,r=function(){return n(new Error("身份证号填写错误, 请重新填写"))};if(t=t.trim(),/^\d{15}$/.test(t)||/^\d{17}[\dXx]{1}$/.test(t)||r(),i=18===t.length?t.substr(6,8):"19"+t.substr(6,6),function(e,t,n,i){if(isNaN(e)||isNaN(t)||isNaN(n))return!1;if(n.length>2||t.length>2||e.length>4)return!1;if(n=parseInt(n,10),t=parseInt(t,10),(e=parseInt(e,10))<1e3||e>9999||t<=0||t>12)return!1;var r=[31,28,31,30,31,30,31,31,30,31,30,31];if((e%400==0||e%100!=0&&e%4==0)&&(r[1]=29),n<=0||n>r[t-1])return!1;if(!0===i){var a=new Date,s=a.getFullYear(),o=a.getMonth(),d=a.getDate();return e<s||e===s&&t-1<o||e===s&&t-1===o&&n<d}return!0}(parseInt(i.substr(0,4),10),parseInt(i.substr(4,2),10),parseInt(i.substr(6,2),10))||r(),18===t.length){for(var a=0,s=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],o=0;o<17;o++)a+=parseInt(t.charAt(o),10)*s[o];a=(12-a%11)%11,("X"!==t.charAt(17).toUpperCase()?parseInt(t.charAt(17),10):10)===a?n():r()}n()},trigger:"change"},Re=function(e,t,n,i){return n=n||"支持"+e+"~"+t+"位的中文、英文（大小写）、整数、下划线、中线、/、. 、空格等输入",{validator:function(i,r,a){void 0!=r&&""!=r||a(),new RegExp("^[a-zA-Z0-9_-/.sΑ-￥]{"+e+","+t+"}$").test(r)||a(new Error(n)),a()},trigger:i||"change"}},Oe=Re(1,30),Ue=Re(1,64);t.a={required:function(e,t){return{validator:function(t,n,i){$.isArray(n)?0===n.length?i(new Error(e||"此处为必填项")):i():""===n||void 0===n?i(new Error(e||"此处为必填项")):i()},required:!0,trigger:t||"change"}}(),account64:N,str16:p,str18:h,str20:g,str24:v,str25:b,str32:F,str36:w,str40:y,str45:I,str50:A,str64:j,str80:x,str100:T,str128:E,str150:S,str250:_,str1000:C,str1500:k,strDefault:z,isInt:ge,int4:D,int5:R,int6:O,int10:U,int11:L,int18:V,int20:q,int24:P,int25:Z,int32:B,int36:K,int50:W,int64:G,int1_100:ve,num:s,num20:M,num99:X,num128:Q,num100:J,num512:Y,num999:H,num1000:ee,num3000:te,num3600:ne,num9999:ie,num99999:re,name:Re,name30:Oe,name64:Ue,level:le,gbId:me,gbId2:pe,civilCode:he,chanNo:ye,id:De,ip:Fe,multiIp:m,ip4gb:c,port:we,email:de,maxWay:be,latitude:Ee,longitude:Te,password:ce,password2:fe,gbIdStep:je,gbIdTimes:xe,serviceSize:Ae,cloudPersize:ue,extraChannelNo:Ie,presetPositions:Se,deviceInfoPrice:_e,vodInCount6:Ce,trunkInCount6:Ce,platformNum:ke,isNum:{type:"number",message:"必须为数字值"},macAddr:ze,phone:$e,uri:Ne,ptzIdleTime:ae,projectNumber:se,nodeNumber:oe,remote:function(e){var t=e.id,n=e.name,i=e.api,r=e.apiPrefix,a=e.msg;return{validator:function(e,s,o){if(""===s)o();else{var d={};d[n]=s,t&&(d.id=t),Service[i](d,r).then(function(e){e.data.status?o(new Error(a||e.data.message)):o()},function(e){o(new Error(e.data.message))})}},trigger:"blur"}}}},BT05:function(e,t,n){"use strict";n.r(t);var i=n("QbLZ"),r=n.n(i),a=n("P2sY"),s=n.n(a),o=n("WIBD"),d=n("kKWf"),l=n("gDS+"),u=n.n(l),c=n("I+Ds"),f=n("BNNy");var m=n("uV9B"),p=n("zE2b"),h={name:"EditForm",mixins:[c.a,m.a],props:{title:{type:String,default:""},flag:{type:String,default:""}},data:function(){return{tab:"first",isShow:!1,model:{},option:{}}},computed:r()({},Object(o.mapGetters)(["userType","siteType"]),{jtree:function(){return this.closest("jtree")},jtable:function(){return this.closest("jtable")},fields:function(){return $.formatFinal(function(e){return[{tag:"el-select",name:"userType",label:"用户类型",default:1==$.db.getUserType()?"2":"1",rules:[f.a.required],createFunction:"formItem"},{tag:"el-select",name:"role",label:"用户角色",rules:[f.a.required],show:function(){return 2==e.model.userType},createFunction:"formItem"},{tag:"el-input",name:"name",label:"用户名",rules:[f.a.required,f.a.str64],createFunction:"formItem"},{tag:"el-input",name:"account",label:"登录账号",tip:["必填，1 ~ 64 个字符，支持数字、英文（大小写）、下划线、中线、以及 / 输入","需保证同一节点内唯一"],data:{props:{disabled:!!e.model.id,disableautocomplete:!0,autocomplete:"new-username"}},rules:[f.a.required,f.a.account64],createFunction:"formItem"},{tag:"el-input",name:"password",label:"密码",type:"password",tip:"必填，1 ~ 30 个字符，支持除了中文、 空格、' & '、 ' # ' 以外的字符输入",data:{props:{autocomplete:"new-password"}},show:function(){return!e.model.id},rules:[f.a.required,f.a.password],createFunction:"formItem"},{tag:"el-input",name:"password-confirm",type:"password",label:"确认密码",tip:"必填，1 ~ 30 个字符，支持除了中文、 空格、' & '、 ' # ' 以外的字符输入",show:function(){return!e.model.id},rules:[f.a.required,f.a.password,{validator:function(t,n,i){n!=e.model.password&&i(new Error("请保证与登录密码一致")),i()},trigger:"change"}],createFunction:"formItem"},{tag:"el-input",name:"userLevel",label:"用户级别",tip:"必填，1 ~ 999 范围内的整数，数字越小，级别越高",default:"100",rules:[f.a.required,f.a.num999],show:function(){return 2==e.model.userType},createFunction:"formItem"},{tag:"el-input",type:"textarea",name:"mappingId",label:"编号",rules:[f.a.str20],createFunction:"formItem"},{tag:"el-input",type:"textarea",name:"descr",label:"说明",rules:[f.a.str128],createFunction:"formItem"}]}(this),null,this.option,!1)},gbFields:function(){return $.formatFinal([{tag:"el-input",name:"gbId",label:"国标编号",rules:[f.a.required,f.a.gbId2],createFunction:"formItem"},{tag:"el-input",name:"gbPassword",label:"密码",rules:[f.a.password],createFunction:"formItem"},{tag:"el-switch",name:"auth",label:"是否鉴权",default:1,data:{props:{activeValue:1,inactiveValue:0,activeText:"开",inactiveText:"关"}},createFunction:"formItem"},{tag:"el-switch",name:"tcp",label:"是否采用TCP",default:1,data:{props:{activeValue:1,inactiveValue:0,activeText:"开",inactiveText:"关"}},change:function(e){this.model.tcp=e},createFunction:"formItem"},{tag:"el-input",name:"number",label:"每次传送数量",default:"10000",rules:[f.a.required,f.a.num99999],createFunction:"formItem"},{tag:"el-input",name:"interval",label:"心跳间隔时间",default:"15",rules:[f.a.num3600],children:[{tag:"template",data:{slot:"append"},children:["秒"]}],createFunction:"formItem"},{tag:"el-switch",name:"subscribeAlarm",label:"订阅告警",default:0,data:{props:{activeValue:1,inactiveValue:0,activeText:"开",inactiveText:"关"}},createFunction:"formItem"}],null,{},!1)},renderInit:function(){return window.formFactoryRender.bind(this,this.fields,{})},renderGBInit:function(){return window.formFactoryRender.bind(this,this.gbFields,{})}}),methods:{setData:function(e,t){var n=this;$.initForm({model:e,ajax:[[Service.listRole,{siteId:e.siteId}],[Service.listUser,{id:e.id},"put"]],events:[function(e){var t=$.db.getConsts().userType,i=$.db.getSites();n.option={siteId:{name:"name",value:"id",list:i},userType:{name:"name",value:"id",list:1==n.userType?t.slice(1):t.slice(1,2)},role:{name:"name",value:"id",list:e[0].items}}},{method:"put",fn:function(e){n.data=e[1].data}},{method:"post",fn:function(t){n.data=e}},function(){$.fire(t,n.data)}]})},open:function(e){var t=this;this.model=s()({},$.modelTpl(this.fields,{},{siteType:this.siteType,siteId:e.siteId})),this.dialog.open(function(){t.setData(e,function(e){var n={id:e.id,siteId:e.siteId},i={};if(n.id){if("gb28181"in e){var r=Util.isEmptyFn(e.gb28181)?{}:JSON.parse(e.gb28181);$.copyValue(i,r,t.gbFields)}$.copyValue(n,e,t.fields),t.model=s()({},n,i)}else{var a=$.modelTpl(t.fields,t.option),o=$.modelTpl(t.gbFields,t.option);s()(n,a,o),t.model=s()({},n,i,{userType:1==$.db.getUserType()?"2":"1"})}t.dialog.end()})})},getSecondFormValue:function(e){var t=this,n={};return this.gbFields.forEach(function(e){if(e.name&&(!e.show||e.show())){var i=t.model[e.name];"password"==e.name?n[e.name]=Object(p.a)(i):n[e.name]=i}}),{gb28181:u()(n)}},getFormValue:function(){var e=this,t=this.fields,n={id:this.model.id,siteId:this.model.siteId};return $.each(t,function(t,i){!i.name||i.show&&!i.show()||"password-confirm"!=i.name&&(n[i.name]=e.model[i.name],"password"==i.name&&(n[i.name]=Object(p.a)(e.model[i.name])))}),s()(n,this.getSecondFormValue(this.model)),n},saveAjax:function(){var e=this;this.start(function(){var t=e.getFormValue();$.persist(t,"addUser","editUser").then(function(t){e.nvMsg(),e.close(),e.jtree.init().then(function(){e.$parent.refreshFn()})}).finally(e.end)})}}},g=n("KHd+"),v=Object(g.a)(h,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("nv-dialog",{ref:"dialog",staticClass:"tab-dialog",attrs:{title:e.title},on:{close:e.closeEvent}},[n("div",{staticClass:"form-content"},[n("el-tabs",{attrs:{type:"border-card"},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[n("el-tab-pane",{attrs:{name:"first"}},[n("span",{attrs:{slot:"label"},slot:"label"},[n("i",{staticClass:"icon icon-basic"}),e._v(" 基础配置")]),e._v(" "),n("form-factory",{ref:"formFactory",attrs:{init:e.renderInit}})],1),e._v(" "),n("el-tab-pane",{attrs:{name:"second"}},[n("span",{attrs:{slot:"label"},slot:"label"},[n("i",{staticClass:"icon icon-gb"}),e._v(" 国标用户配置")]),e._v(" "),n("form-factory",{ref:"gbFormFactory",attrs:{init:e.renderGBInit}})],1)],1),e._v(" "),n("div",{staticClass:"btns"},[n("el-button",{attrs:{loading:e.loading,size:"mini",type:"primary"},on:{click:e.submit}},[e._v("确定")]),e._v(" "),n("el-button",{attrs:{size:"mini"},on:{click:e.close}},[e._v("取消")])],1)],1)])},[],!1,null,null,null);v.options.__file="dialog.vue";var b=v.exports,F={name:"PwdForm",mixins:[c.a],props:{title:{type:String,default:""}},data:function(){return{isOpen:!1,model:{},isLoading:!1}},computed:{jtable:function(){return this.$parent.$refs.jtable},fields:function(){return $.formatFinal([{tag:"el-input",name:"password",label:"新密码",tip:"必填，1 ~ 30 个字符，支持除了中文、 空格、' & '、 ' # ' 以外的字符输入",rules:[f.a.required,f.a.password],createFunction:"formItem"}],{},this.option,!0)}},methods:{setData:function(e,t){$.fire(t,this.data=e)},closeEvent:function(){this.model={}},open:function(e){var t=this;this.setData(e,function(e){t.model=$.modelTpl(t.fields,t.option,e),t.isOpen=!0})},close:function(){this.isOpen=!1,this.resetForm()},saveAjax:function(e){var t=this;this.isLoading=!0;var n=Object(p.a)(this.model.password);Service.resetPwd(s()({},this.model,{password:n})).then(function(n){t.isLoading=!1,t.$message.success("处理成功"),t.jtable.init(),$.fire(e)}).finally(function(){t.isLoading=!1,$.fire(e)})},submit:function(){var e=this;this.validate(function(){if(e.isLoading)return!1;e.saveAjax(function(){e.close()})})}}},w=(n("TOnQ"),Object(g.a)(F,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"node-copy-form",attrs:{visible:e.isOpen,"modal-append-to-body":!1,width:"600px",title:"重置密码"},on:{"update:visible":function(t){e.isOpen=t},close:e.closeEvent}},[n("form-factory",{ref:"formFactory",attrs:{init:e.renderInit}},[n("el-form-item",[n("el-button",{staticClass:"btn2",attrs:{loading:e.isLoading,size:"small",type:"primary"},on:{click:e.submit}},[e._v("确定")]),e._v(" "),n("el-button",{staticClass:"btn2",attrs:{size:"small"},on:{click:e.close}},[e._v("取消")])],1)],1)],1)},[],!1,null,null,null));w.options.__file="pwdDialog.vue";var y={components:{EditForm:b,PwdForm:w.exports},mixins:[d.a],data:function(){this.$createElement;var e=this;return{filter:{},title:"",prevNodeKey:null,treeSetting:{nodeKey:"siteId",props:{children:"children",label:"name"},initNodeFn:function(t){var n=e.prevNodeKey?[e.prevNodeKey]:[t[0][this.nodeKey]];e.jtree.curNodeKeys=n,e.jtree.setCurrentNode(n[0])},ajax:{init:function(){return Service.listSiteTree({type:"User"}).then(function(e){return e.items})}},nodeClickFn:function(t,n){e.prevNodeKey=t.siteId,e.jtable.clear(function(){return e.refreshFn(t)})},renderFn:function(e,t){t.node;var n=t.data,i=this.$createElement;return i("div",{class:{node:!0,"data-key":n.siteId}},[i("span",{class:["icon","icon-"+n.siteType]}),i("span",[n.siteName]),i("span",{class:"count"},["(",n.count,")"])])}},gridConfig:{selectable:!0,pagination:!0,listenerWidth:"180px",actions:[{name:"refresh",icon:"icon icon-refresh",title:"刷新",handleFn:function(t){e.refreshFn()}},{name:"create",icon:"el-icon-edit-outline",title:"新建",handleFn:function(t){e.title="新建用户";var n=e.jtree.getActive().siteId;e.dialog.open({siteId:n})}},{name:"batchDel",icon:"el-icon-delete",title:"批量删除",handleFn:function(){e.delFn()}}],listeners:[{name:"delete",icon:"icon icon-kickout",title:"强制退出",showFn:function(e){return 2==e.userType},handleFn:function(t){var n=t.id;Service.kickUser({id:n}).then(function(t){return e.$message.success("操作成功")})}},{name:"delete",icon:"icon icon-password",title:"密码修改",handleFn:function(t){e.$refs.pwdDialog.open(t)}},{name:"edit",icon:"el-icon-edit",title:"编辑",handleFn:function(t){e.title="编辑用户",e.dialog.open(t)}},{name:"delete",icon:"el-icon-delete",title:"删除",handleFn:function(t){e.delFn(t)}}],column:[{type:"index",name:"序号",width:"60",minWidth:"50"},{key:"userType",name:"用户类型",sortable:!0,minWidth:"100",format:function(e){return""+$.v2str("userType",e)}},{key:"name",name:"用户名",minWidth:"100",sortable:!0},{key:"account",name:"登录账号",minWidth:"100"},{key:"role",name:"用户角色",minWidth:"200",format:function(e){return $.isEmptyFn(e)?"--":e}},{key:"userLevel",name:"用户级别",format:function(e){return $.isEmptyFn(e)?"--":e}},{key:"gbId",name:"国标编号",format:function(e){return $.isEmptyFn(e)?"--":e}}],ajax:{init:function(t){return Service.listUser(s()({},t,e.filter)).then(function(e){return e})}}}}},computed:r()({jtree:function(){return this.$refs.jtree},jtable:function(){return this.$refs.jtable},dialog:function(){return this.$refs.dialog},copyDialog:function(){return this.$refs.copyDialog}},Object(o.mapGetters)(["siteId"])),mounted:function(){var e=this;this.jtree.init().then(function(){return e.refreshFn()})},methods:{refreshFn:function(){var e=this.jtree.getActive().siteId;s()(this.filter,{siteId:e}),this.jtable.init()},delFn:function(e){var t=this,n=[e];if(!e&&!(n=this.jtable.getChecked()).length)return this.$message.warning("请至少选择一条信息");this.$confirm("确认要删除吗？","提示",{type:"warning"}).then(function(){Service.delUser({ids:n.map(function(e){return e.id})}).then(function(e){t.$message.success("操作成功"),t.jtree.init().then(function(){return t.refreshFn()})})},function(){return t.$message.warning("操作取消")})}}},I=(n("Gm5X"),Object(g.a)(y,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"page-user clearfix"},[t("div",{staticClass:"sidebar fl"},[t("nv-tree",{ref:"jtree",attrs:{setting:this.treeSetting}})],1),this._v(" "),t("div",{staticClass:"main device-list fl"},[t("nv-table",{ref:"jtable",attrs:{setting:this.gridConfig}})],1),this._v(" "),t("edit-form",{ref:"dialog",attrs:{title:this.title}}),this._v(" "),t("pwd-form",{ref:"pwdDialog"})],1)},[],!1,null,null,null));I.options.__file="index.vue";t.default=I.exports},Gd76:function(e,t){e.exports=function(e,t,n){var i=new Blob([e],{type:n||"application/octet-stream"});if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(i,t);else{var r=window.URL.createObjectURL(i),a=document.createElement("a");a.style.display="none",a.href=r,a.setAttribute("download",t),void 0===a.download&&a.setAttribute("target","_blank"),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(r)}}},Gm5X:function(e,t,n){"use strict";var i=n("8ioA");n.n(i).a},"I+Ds":function(e,t,n){"use strict";t.a={data:function(){return{model:{},inline:!1,loading:!1}},props:{title:String},computed:{dialog:function(){return this.find("dialog")},renderInit:function(){return window.formFactoryRender.bind(this,this.fields,{})}},methods:{start:function(e){this.loading=!0,$.fire(e)},end:function(e){var t=this;$.fire(e),setTimeout(function(){t.loading=!1},200)},find:function(e){return $.ref.call(this,e)},closest:function(e){return $.pref.call(this,e)},getForm:function(){return this.$refs.formFactory.$refs.form},validate:function(e,t,n){var i=this;try{this.getForm().validate(function(n,r){if(!n)return t&&t.call(i,r),!1;e&&e.call(i)},n)}catch(e){console.log(e)}},submit:function(e){this.validate(this.saveAjax)},resetForm:function(e){this.getForm().resetFields(e||this.defModel)},close:function(){this.dialog.close(),this.tab&&(this.tab="first")}}}},MXIZ:function(e,t,n){},TOnQ:function(e,t,n){"use strict";var i=n("MXIZ");n.n(i).a},kKWf:function(e,t,n){"use strict";var i=n("Gd76"),r=n.n(i);t.a={data:function(){return{downLoading:!1}},methods:{timeRangeChangeFn:function(){var e=this.filter.timeRange,t=[$.getCurDay().from,$.getCurDay().to];return $.isEmptyFn(e)?this.filter.timeRange=["",""]:this.filter.timeRange.every(function(e){return 0==e})?this.filter.timeRange=t:this.filter.timeRange=this.filter.timeRange.map(function(e){return e instanceof Date?$.Date.getTickInSec(e):e})},clearFilter:function(e,t){for(var n in this.filter)this.filter[n]="timeRange"==n?[$.getCurDay().from,$.getCurDay().to]:e&&e[n]||"";t&&t()},query:function(){var e=this;this.jtable.clear(function(){e.jtable.init()})},download:function(e,t){var n=this;this.downLoading=!0,Service[e](t||this.filter).then(function(e){n.downLoading=!1;var t=e.headers["content-disposition"],i=decodeURI(t.match(/filename=(.*)/)[1],"UTF-8");r()(e.data,i)})}}}},uV9B:function(e,t,n){"use strict";var i=n("gDS+"),r=n.n(i),a=n("4d7F"),s=n.n(a);t.a={data:function(){return{tab:"first",gbOption:{}}},methods:{getFirstForm:function(){return this.$refs.formFactory.$refs.form},getSecondForm:function(){return this.$refs.gbFormFactory.$refs.form},validateFirst:function(e,t,n){var i=this;return new s.a(function(e,t){i.getFirstForm().validateTabForm(function(t,n){e(t)},n)})},validateSecond:function(e,t,n){var i=this;return new s.a(function(e,t){i.getSecondForm().validate(function(t,n){e(t)},!1)})},getSecondFormValue:function(e){var t=this,n={};return this.gbFields.forEach(function(e){if(e.name&&(!e.show||e.show())){var i=t.model[e.name];n[e.name]=i}}),{gb28181:r()(n)}},submit:function(e){var t=this;"first"==this.tab?s.a.all([this.validateFirst()]).then(function(e){e[0]&&t.saveAjax()}):s.a.all([this.validateFirst(),this.validateSecond()]).then(function(e){return e[0]||e[1]?e[0]?e[1]?void(e[0]&&e[1]&&t.saveAjax()):t.nvMsg("请确认国标配置","warning"):t.nvMsg("请确认基础配置","warning"):t.nvMsg("请确认基础配置、国标配置","warning")})},closeEvent:function(){this.tab="first"}}}}}]);