(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7e13"],{"/SyE":function(t,e,n){},"9oRo":function(t,e,n){},BNNy:function(t,e,n){"use strict";var i=function(t,e,n,i){return{pattern:"string"==typeof t?new RegExp(t,i):t,message:e||"输入格式不匹配",trigger:n||"change"}},a=function(t,e,n,a){return i("^.{"+t+","+e+"}$",n,"change",a)},r=function(t,e,n){return i("^[0-9]{"+t+","+e+"}$",n)},o=function(t,e,n,i){return{validator:function(i,a,r){""===a&&r(),a+="";var o=parseInt(a);a.length===(o+"").length&&t<=o&&o<=e?r():r(new Error(n||$.tpl("请输入{min} ~ {max}范围内的整数",{min:t,max:e})))},trigger:i||"change"}},s=function(t){return $.tpl("限制{size}位字符输入",{size:t})},l=function(t){return $.tpl("仅支持数字输入，限制最大输入{size}位字符，最小为1位字符",{size:t})},d=/^[0-9]{20}$/,c=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$|^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,u={validator:function(t,e,n){""===e&&n(),d.test(e)?n():c.test(e)?n():n(new Error("IP地址格式不正确"))},trigger:"change"},f=/^((25[0-5]|2[0-4]\d|[01]?\d\d?)($|(?!\.$)\.)){4}$|^((25[0-5]|2[0-4]\d|[01]?\d\d?)($|(?!\.$)\.)){3}\*$|^((25[0-5]|2[0-4]\d|[01]?\d\d?)($|(?!\.$)\.)){2}\*\.((25[0-5]|2[0-4]\d|[01]?\d\d?))$|^((25[0-5]|2[0-4]\d|[01]?\d\d?)($|(?!\.$)\.)){2}\*\.\*$|^((25[0-5]|2[0-4]\d|[01]?\d\d?)($|(?!\.$)\.)){3}((25[0-5]|2[0-4]\d|[01]?\d\d?))\-((25[0-5]|2[0-4]\d|[01]?\d\d?))$/,m={validator:function(t,e,n){""===e&&n();for(var i=e.trim().split(/,|，/),a=0,r=0;r<i.length;r++)f.test(i[r])||a++;a>0?n(new Error("IP格式错误")):n()},trigger:"change"},h=a(1,16,s(16)),p=a(1,18,s(18)),g=a(1,20,s(20)),v=a(1,24,s(24)),b=a(1,25,s(25)),y=a(1,32,s(32)),F=a(1,36,s(36)),w=a(1,40,s(40)),C=a(1,45,s(45)),I=a(1,50,s(50)),x=a(1,64,s(64)),S=a(1,80,s(80)),_=a(1,100,s(100)),k=a(1,128,s(128),"m"),A=a(1,150,s(150)),j=a(1,250,s(250)),z=a(1,1e3,s(1e3)),E=a(1,1500,s(1500)),N=a(1,45,s(45)),T=function(t,e,n,a){return i("^[a-zA-Z0-9/_-]{"+t+","+e+"}$",n,"change",a)}(1,64,"仅允许输入字母、数字、下划线、中线、以及 / 输入，长度范围 1 ~ 64 位"),D=r(1,4,l(4)),R=r(1,5,l(5)),P=r(1,6,l(6)),H=r(1,10,l(10)),M=r(1,11,l(11)),B=r(1,18,l(18)),O=r(1,20,l(20)),V=r(1,24,l(24)),L=r(1,25,l(25)),U=r(1,32,l(32)),W=r(1,36,l(36)),q=r(1,50,l(50)),K=r(1,64,l(64)),Z=o(5,20),G=o(1,99),J=o(1,100),Q=o(0,128),X=o(1,512),Y=o(1,999),tt=o(1,1e3),et=o(1,3e3),nt=o(1,3600),it=o(1,9999),at=o(1,99999),rt=o(5,60,"可输入5-60中的任何数字"),ot=i("^(([1-9]{1}[0-9]{0,6}))$","可输入1—9999999中的任何数字"),st=i("^(([1-9]{1}[0-9]{0,5}))$","可输入1—999999中的任何数字"),lt=i(/^(([^<>()[\]\\.,;:\s@\\"]+(\.[^<>()[\]\\.,;:\s@\\"]+)*)|(\\".+\\"))@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,"邮箱格式不正确"),dt=i("^(([1-9]{1}[0-9]{0,3})|10000|0)$","可输入0—10000中的任何数字，0的级别最小，10000的级别最大"),ct=i("^(([1-9]\\d{0,4})|0)(\\.\\d{1,2})?$","支持数字输入，支持小数点后2位，最大支持小数点前4位数字输入，最大9999G"),ut=i("^[^&#\\s一-龥]{1,30}$","支持1 ~ 30位，除了中文、 空格、' & '、 '#' 以外的字符输入"),ft=i("^[a-zA-Z0-9_]{1,30}$","密码由数字、字母、下划线组成，长度为1~30位"),mt=i(/^[0-9]{1,20}$/,"请输入1~20位长度的数字"),ht=i(/^\d{13}$|^\d{20}$/,"请输入13或20位长度的数字"),pt=i(/^\d{1,20}$/,"请输入1~20位长度的数字"),gt=i(/^[1-9]\d*$/,"仅支持输入非零整数"),vt=i(/^[1-9]\d?$|^100$/,"仅支持输入非零整数, 数字范围1~100"),bt=o(0,1e3,"仅支持数字输入，默认为4，不输入数字则不做限制，最大可设1000路"),yt=i(/^[0-9\\-]{1,20}$/,"电话号码格式不正确,例如 010-82325561, 支持20位输入"),$t=i(c,"IP地址格式不正确"),Ft=o(1,65535,"端口号请输入1到65535的整数"),wt=i("^(([1-9]{1}[0-9]{0,4}))$|^[0-9]{20}$","可输入1—99999中的任何数字，或20位的国标编号"),Ct=i("^(([1-9]{1}[0-9]{0,4}))$","可输入1—99999中的任何数字"),It=i("^(([1-9]\\d{0,19})|0)(\\.\\d{1,2})?$","支持20位数字，精确到小数点后俩位"),xt=i("^(([1-9]{1}[0-9]{0,2}))$|^1000$","可输入1—1000中的任何数字"),St=i("^([1-9]{1}[0-9]{0,2})$|^([1-2]{1})([0-9]{0,3})$|^3000$","可输入1—3000中的任何数字"),_t=i("^-?(?:(?:180(?:\\.0{1,16})?)|(?:(?:(?:1[0-7]\\d)|(?:[1-9]?\\d))(?:\\.\\d{1,16})?))$","经度范围：-180~180，精确到小数点后16位"),kt=i("^-?(?:90(?:\\.0{1,16})?|(?:[1-8]?\\d(?:\\.\\d{1,16})?))$","纬度范围：-90~90，精确到小数点后16位"),At=i("^(([1-9]{1}[0-9]{0,3}))$","可输入1—9999中的任何数字"),jt=i("^(([1-9]\\d{0,9})|0)(\\.\\d{1,2})?$","支持10位数字，精确到小数点后俩位"),zt=i("^([1-9]\\d{0,4})?$","最大支持5位数字输入"),Et=i("^([1-9]\\d{0,7})?$","最大支持8位数字输入"),Nt=i("^([0-9a-fA-F]{2}[:-]){5}([0-9a-fA-F]{2})$","MAC地址格式不正确,格式如: 00:A3:19:EF:E4:24"),Tt=i(function(){var t="http, https, ftp".split(",").join("|").replace(/\s/g,"");return new RegExp("^(?:(?:"+t+")://)?(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-?)*[a-z\\u00a1-\\uffff0-9])*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))?)(?::\\d{2,5})?(?:/[^\\s]*)?$","i")}()),Dt={validator:function(t,e,n){""===e&&n();var i,a=function(){return n(new Error("身份证号填写错误, 请重新填写"))};if(e=e.trim(),/^\d{15}$/.test(e)||/^\d{17}[\dXx]{1}$/.test(e)||a(),i=18===e.length?e.substr(6,8):"19"+e.substr(6,6),function(t,e,n,i){if(isNaN(t)||isNaN(e)||isNaN(n))return!1;if(n.length>2||e.length>2||t.length>4)return!1;if(n=parseInt(n,10),e=parseInt(e,10),(t=parseInt(t,10))<1e3||t>9999||e<=0||e>12)return!1;var a=[31,28,31,30,31,30,31,31,30,31,30,31];if((t%400==0||t%100!=0&&t%4==0)&&(a[1]=29),n<=0||n>a[e-1])return!1;if(!0===i){var r=new Date,o=r.getFullYear(),s=r.getMonth(),l=r.getDate();return t<o||t===o&&e-1<s||t===o&&e-1===s&&n<l}return!0}(parseInt(i.substr(0,4),10),parseInt(i.substr(4,2),10),parseInt(i.substr(6,2),10))||a(),18===e.length){for(var r=0,o=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],s=0;s<17;s++)r+=parseInt(e.charAt(s),10)*o[s];r=(12-r%11)%11,("X"!==e.charAt(17).toUpperCase()?parseInt(e.charAt(17),10):10)===r?n():a()}n()},trigger:"change"},Rt=function(t,e,n,i){return n=n||"支持"+t+"~"+e+"位的中文、英文（大小写）、整数、下划线、中线、/、. 、空格等输入",{validator:function(i,a,r){void 0!=a&&""!=a||r(),new RegExp("^[a-zA-Z0-9_-/.sΑ-￥]{"+t+","+e+"}$").test(a)||r(new Error(n)),r()},trigger:i||"change"}},Pt=Rt(1,30),Ht=Rt(1,64);e.a={required:function(t,e){return{validator:function(e,n,i){$.isArray(n)?0===n.length?i(new Error(t||"此处为必填项")):i():""===n||void 0===n?i(new Error(t||"此处为必填项")):i()},required:!0,trigger:e||"change"}}(),account64:T,str16:h,str18:p,str20:g,str24:v,str25:b,str32:y,str36:F,str40:w,str45:C,str50:I,str64:x,str80:S,str100:_,str128:k,str150:A,str250:j,str1000:z,str1500:E,strDefault:N,isInt:gt,int4:D,int5:R,int6:P,int10:H,int11:M,int18:B,int20:O,int24:V,int25:L,int32:U,int36:W,int50:q,int64:K,int1_100:vt,num:o,num20:Z,num99:G,num128:Q,num100:J,num512:X,num999:Y,num1000:tt,num3000:et,num3600:nt,num9999:it,num99999:at,name:Rt,name30:Pt,name64:Ht,level:dt,gbId:mt,gbId2:ht,civilCode:pt,chanNo:wt,id:Dt,ip:$t,multiIp:m,ip4gb:u,port:Ft,email:lt,maxWay:bt,latitude:kt,longitude:_t,password:ut,password2:ft,gbIdStep:xt,gbIdTimes:St,serviceSize:It,cloudPersize:ct,extraChannelNo:Ct,presetPositions:At,deviceInfoPrice:jt,vodInCount6:zt,trunkInCount6:zt,platformNum:Et,isNum:{type:"number",message:"必须为数字值"},macAddr:Nt,phone:yt,uri:Tt,ptzIdleTime:rt,projectNumber:ot,nodeNumber:st,remote:function(t){var e=t.id,n=t.name,i=t.api,a=t.apiPrefix,r=t.msg;return{validator:function(t,o,s){if(""===o)s();else{var l={};l[n]=o,e&&(l.id=e),Service[i](l,a).then(function(t){t.data.status?s(new Error(r||t.data.message)):s()},function(t){s(new Error(t.data.message))})}},trigger:"blur"}}}},CbuI:function(t,e,n){"use strict";var i=n("xVR9");n.n(i).a},Gd76:function(t,e){t.exports=function(t,e,n){var i=new Blob([t],{type:n||"application/octet-stream"});if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(i,e);else{var a=window.URL.createObjectURL(i),r=document.createElement("a");r.style.display="none",r.href=a,r.setAttribute("download",e),void 0===r.download&&r.setAttribute("target","_blank"),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a)}}},"I+Ds":function(t,e,n){"use strict";e.a={data:function(){return{model:{},inline:!1,loading:!1}},props:{title:String},computed:{dialog:function(){return this.find("dialog")},renderInit:function(){return window.formFactoryRender.bind(this,this.fields,{})}},methods:{start:function(t){this.loading=!0,$.fire(t)},end:function(t){var e=this;$.fire(t),setTimeout(function(){e.loading=!1},200)},find:function(t){return $.ref.call(this,t)},closest:function(t){return $.pref.call(this,t)},getForm:function(){return this.$refs.formFactory.$refs.form},validate:function(t,e,n){var i=this;try{this.getForm().validate(function(n,a){if(!n)return e&&e.call(i,a),!1;t&&t.call(i)},n)}catch(t){console.log(t)}},submit:function(t){this.validate(this.saveAjax)},resetForm:function(t){this.getForm().resetFields(t||this.defModel)},close:function(){this.dialog.close(),this.tab&&(this.tab="first")}}}},VAIr:function(t,e,n){},"WYQ+":function(t,e,n){"use strict";var i=n("/SyE");n.n(i).a},ebL3:function(t,e,n){"use strict";n.r(e);var i=n("P2sY"),a=n.n(i),r=n("/f1G"),o=n.n(r),s=n("GQeE"),l=n.n(s),d=n("kKWf"),c=n("QbLZ"),u=n.n(c),f=n("4d7F"),m=n.n(f),h=n("I+Ds"),p=n("BNNy"),g={props:{model:{type:Object,default:function(){return{days:"all",from:"00:00:00",to:"23:59:59"}}}},data:function(){return{from:"00:00:00",to:"23:59:59",validFlag:!0,tips:"请选择起止时间",daysOpts:[{id:1,text:"周一"},{id:2,text:"周二"},{id:3,text:"周三"},{id:4,text:"周四"},{id:5,text:"周五"},{id:6,text:"周六"},{id:0,text:"周日"}]}},computed:{fromTo:{get:function(){var t="2019,1,1 "+this.from,e="2019,1,1 "+this.to;return[new Date(t),new Date(e)]},set:function(t){$.isEmptyFn(t)?(this.from="",this.to=""):(this.from=moment(t[0]).format("HH:mm:ss"),this.to=moment(t[1]).format("HH:mm:ss"))}},checkDays:{get:function(){var t=this;return"all"==this.model.days?this.daysOpts.map(function(t){return t.id}):this.daysOpts.filter(function(e){return t.model.days.indexOf(e.id)>-1}).map(function(t){return t.id})},set:function(t){this.model.days=t}},checkAll:{get:function(){return"all"==this.model.days||7==this.model.days.length},set:function(t){return this.model.days=t?this.daysOpts.map(function(t){return t.id}):[]}}},watch:{model:function(t){this.from=t.from||"00:00:00",this.to=t.to||"23:59:59"}},methods:{change:function(t){return Util.isEmptyFn(t)?(this.validFlag=!1,this.tips="请指定录像起止时间",!1):moment(t[1]).diff(moment(t[0]))<0?(this.validFlag=!1,this.tips="开始时间需小于结束时间",!1):(this.validFlag=!0,this.tips="",this.from=moment(t[0]).format("HH:mm:ss"),void(this.to=moment(t[1]).format("HH:mm:ss")))},getValue:function(){return{days:7==this.checkDays.length?"all":this.checkDays,from:this.from,to:this.to}},validate:function(t){var e=this;return new m.a(function(t){t(e.checkDays.length&&e.validFlag)})}}},v=(n("WYQ+"),n("KHd+")),b=Object(v.a)(g,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"date-plan"},[n("el-form-item",{attrs:{label:"日期计划",required:""}},[n("el-checkbox",{model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")]),t._v(" "),n("el-checkbox-group",{model:{value:t.checkDays,callback:function(e){t.checkDays=e},expression:"checkDays"}},t._l(t.daysOpts,function(e,i){return n("el-checkbox",{key:i,attrs:{label:e.id}},[t._v(t._s(e.text))])})),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:0==t.model.days.length,expression:"model.days.length == 0"}],staticClass:"tips"},[t._v("日期计划不能为空！")])],1),t._v(" "),n("el-form-item",{attrs:{label:"录像时间",required:""}},[n("el-time-picker",{attrs:{"is-range":"","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",placeholder:"选择时间范围"},on:{change:t.change},model:{value:t.fromTo,callback:function(e){t.fromTo=e},expression:"fromTo"}}),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.validFlag,expression:"!validFlag"}],staticClass:"tips"},[t._v(t._s(t.tips))])],1)],1)},[],!1,null,null,null);b.options.__file="timePlan.vue";var y=b.exports,F={},w={props:{lostCameras:{type:Array,default:function(){return[]}},doneCameras:{type:Array,default:function(){return[]}}},data:function(){return{tBodyHeight:null,tFootHeight:42,count:0,selectable:!0,pageNo:1,pageSize:20,pageSizes:[10,20,30,40,50,100],columns:[{type:"index",name:"序号",width:"60",minWidth:"50px"},{key:"id",name:"摄像机编号"},{key:"name",name:"摄像机名称"},{key:"deviceSubType",name:"设备类型",format:function(t){return'<i class="icon icon-Camera-'+t+'" style="margin-right: 5px; color:#66b1ff;"></i>'+$.v2str("cameraType",t)}},{key:"zoneName",name:"分区名称"},{key:"zoneName",name:"所属分区"},{key:"mappingId",name:"编号",format:function(t){return Util.isEmptyFn(t)?"--":t}},{key:"gbId",name:"国标编号",format:function(t){return Util.isEmptyFn(t)?"--":t}}]}},computed:{list:function(){return this.doneCameras.concat(this.lostCameras)},tableList:function(){var t=(this.pageNo-1)*this.pageSize,e=t+this.pageSize;return this.list.slice(t,e)}},watch:{tBodyHeight:function(t){this.tBodyHeight=t}},mounted:function(){F={},this.doneCameras.forEach(function(t){F[t.id]=t}),this.setSelection(),this.setCount(),this.resizeFn()},methods:{resizeFn:function(){var t=this.$el,e=this.$el.children[0];this.tBodyHeight=t.clientHeight-e.clientHeight-this.tFootHeight},setCount:function(){this.count=l()(F).length},getCell:function(t,e){return"index"==t.type?this.pageSize*(this.pageNo-1)+(e.$index+1):t.format?t.format(e.row[t.key],e):e.row[t.key]},setSelection:function(){var t=this;o()(F).forEach(function(e){t.$refs.table.toggleRowSelection(e)})},selectFn:function(t){var e=this;F={},t.length&&t.forEach(function(t){e.$set(F,t.id,t)}),this.setCount()},sizeChange:function(t){var e=this;this.pageSize=t,this.$nextTick(function(){e.setSelection()})},currentChange:function(t){var e=this;this.pageNo=t,this.$nextTick(function(){e.setSelection()})},getValue:function(){return{cameras:o()(F).map(function(t){return t.id})}},validate:function(t){var e=this;return new m.a(function(t,n){var i=o()(F);i.length||e.msg("请至少选择一个摄像机!"),t(!!i.length)})},clear:function(t){F={},this.count=0,this.pageNo=1,this.pageSize=this.pageSize,this.selectFn([]),this.setSelection(),t&&t()}}},C=(n("jko9"),Object(v.a)(w,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"edit-camera"},[n("div",{staticClass:"total"},[t._v("已选取"),n("b",{staticStyle:{color:"red"}},[t._v(" "+t._s(t.count)+" ")]),t._v("个摄像机")]),t._v(" "),n("el-table",{ref:"table",staticStyle:{width:"90%"},attrs:{data:t.tableList,height:t.tBodyHeight+"px",stripe:"",border:"","highlight-current-row":"",resizable:""},on:{"select-all":t.selectFn,select:t.selectFn}},[t.selectable?n("el-table-column",{attrs:{type:"selection",align:"center"}}):t._e(),t._v(" "),t._l(t.columns,function(e,i){return n("el-table-column",{key:i,attrs:{sortable:!!e.sortable&&e.sortable,type:e.type||"",prop:e.key||"",label:e.name,align:e.align||"center",width:e.width||"","min-width":e.minWidth||"",formatter:e.formatter&&e.formatter(e),"show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(i){return[n("span",{domProps:{innerHTML:t._s(t.getCell(e,i))}})]}}])})})],2),t._v(" "),n("div",{staticClass:"page-info"},[n("el-pagination",{attrs:{total:t.list.length,"page-sizes":t.pageSizes,"current-page":t.pageNo,"page-size":t.pageSize,layout:"total, prev, pager, next, sizes, jumper"},on:{"size-change":t.sizeChange,"current-change":t.currentChange}})],1)],1)},[],!1,null,null,null));C.options.__file="editCamera.vue";var I=C.exports,x=n("uV9B"),S={name:"EditForm",components:{EditCamera:I},mixins:[h.a,x.a],props:{title:{type:String,default:""},flag:{type:String,default:""}},data:function(){return{tab:"first",model:{},option:{},doneCameras:[],lostCameras:[]}},computed:{jtree:function(){return this.closest("jtree")},jtable:function(){return this.closest("jtable")},fields:function(){return $.formatFinal(function(t){return[{tag:"el-input",label:"录像计划名称",name:"name",tip:["请保证同一节点内，录像计划名称唯一"],rules:[p.a.required,p.a.str64],data:{props:{disabled:!!t.model.id}},createFunction:"formItem"},{tag:"div",data:{class:{"form-title":!0}},children:["录像计划时间表"]},{tag:y,data:{ref:"datePlan",class:"form-item-days",props:{model:t.model}},createFunction:"comp"},{tag:"el-select",name:"streamMode",label:"取流方式",rules:[p.a.required],createFunction:"formItem"},{tag:"el-input",name:"circle",label:"存储周期",default:"30",rules:[p.a.required,p.a.int1_100],children:[{tag:"template",data:{slot:"append"},children:["天"]}],createFunction:"formItem"},{tag:"el-radio-group",name:"storageId",label:"存储服务器",rules:[p.a.required],createFunction:"formItem"}]}(this),$.db.getFinal(),this.option,!1)}},methods:{setData:function(t,e){var n=this;$.initForm({model:t,ajax:[[Service.listDeviceWithoutPlan,{siteId:t.siteId}],[Service.listPlan,{siteId:t.siteId,id:t.id},"put"]],events:[function(t){n.option={storageId:{name:"name",value:"id",list:t[0].items.storages||[]}},n.lostCameras=t[0].items.cameras,n.doneCameras=[]},{method:"put",fn:function(t){n.data=t[1].data,n.doneCameras=t[1].data.cameras}},{method:"post",fn:function(e){n.data=t}},function(){$.fire(e,n.data)}]})},open:function(t){var e=this;this.model=this.defModel=$.extend(!0,$.modelTpl(this.fields),{days:"all"}),this.setData(t,function(t){e.dialog.open(function(){var n={id:t.id};if(n.id){var i=t.from,r=t.to,o=t.days;n=a()({},$.copyValue(n,t,e.fields),{from:i,to:r,days:o})}else n=$.modelTpl(e.fields,e.option,{days:"all"});e.model=$.extend(!0,{},n),e.dialog.end()})})},getFormValue:function(){var t=this,e={id:this.data.id,siteId:this.jtree.getActive().siteId};return $.each(this.fields,function(n,i){i.name&&(e[i.name]=t.model[i.name])}),e},validateBase:function(t,e,n){var i=this;return new m.a(function(t,e){i.getForm().validateTabForm(function(e,n){t(e)},n)})},submit:function(){var t=this;m.a.all([this.validateBase(),this.$refs.formFactory.$refs.datePlan.validate(),this.$refs.editCamera.validate()]).then(function(e){e[0]&&e[1]&&e[2]&&t.saveAjax(function(){return t.dialog.close()}),e[0]||t.msg("请核准基础配置信息!"),e[1]||t.msg("请核准日期计划!")})},saveAjax:function(){var t=this;this.start(function(){var e=t.getFormValue(),n=a()({},t.$refs.formFactory.$refs.datePlan.getValue(),t.$refs.editCamera.getValue()),i=u()({},e,n);Service[i.id?"editPlan":"addPlan"](i).then(function(e){t.doneCameras.length=0,t.lostCameras.length=0,t.$refs.editCamera.clear(function(){t.nvMsg(),t.jtree.init().then(function(){return t.$parent.refreshFn()}),t.close()})}).finally(t.end)})},close:function(){this.dialog.close(),this.$refs.editCamera.clear(),this.tab="first"}}},_=(n("uGIX"),Object(v.a)(S,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("nv-dialog",{ref:"dialog",staticClass:"tab-dialog store-dialog",attrs:{title:t.title},on:{close:t.closeEvent}},[n("div",{staticClass:"form-content"},[n("el-tabs",{class:"tab-"+t.tab,attrs:{type:"border-card"},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[n("el-tab-pane",{attrs:{label:"基础配置",name:"first"}},[n("span",{attrs:{slot:"label"},slot:"label"},[n("i",{staticClass:"icon icon-basic"}),t._v(" 基础配置")]),t._v(" "),n("form-factory",{ref:"formFactory",attrs:{init:t.renderInit}})],1),t._v(" "),n("el-tab-pane",{attrs:{label:"国标配置",name:"second"}},[n("span",{attrs:{slot:"label"},slot:"label"},[n("i",{staticClass:"icon icon-Camera"}),t._v(" "),n("i",[t._v("选取摄像机")])]),t._v(" "),n("edit-camera",{ref:"editCamera",attrs:{doneCameras:t.doneCameras,lostCameras:t.lostCameras}})],1)],1),t._v(" "),n("div",{staticClass:"btns"},[n("el-button",{attrs:{loading:t.loading,size:"mini",type:"primary"},on:{click:t.submit}},[t._v("确定")]),t._v(" "),n("el-button",{attrs:{size:"mini"},on:{click:t.close}},[t._v("取消")])],1)],1)])},[],!1,null,null,null));_.options.__file="dialog.vue";var k={name:"StoreList",components:{EditForm:_.exports},mixins:[d.a],data:function(){this.$createElement;var t=this;return{filter:{siteId:""},title:"",prevNode:null,prevNodeKey:null,treeSetting:{nodeKey:"siteId",props:{children:"children",label:"name"},initNodeFn:function(e){var n=t.prevNodeKey?[t.prevNodeKey]:[e[0][this.nodeKey]];t.jtree.curNodeKeys=n,t.jtree.setCurrentNode(n[0])},ajax:{init:function(){return Service.listSiteTree({type:"Recordplan"}).then(function(t){return t.items})}},nodeClickFn:function(e,n){t.prevNode=e,t.prevNodeKey=e.siteId,t.jtable.clear(function(){return t.refreshFn(e)})},renderFn:function(t,e){e.node;var n=e.data,i=this.$createElement;return i("div",{class:{node:!0,"data-key":n.siteId}},[i("span",{class:["icon","icon-"+n.siteType]}),i("span",[n.siteName]),i("span",{class:"count"},["(",n.count,")"])])}},gridConfig:{selectable:!1,pagination:!0,expandable:!0,actions:[{name:"refresh",icon:"icon icon-refresh",title:"刷新",handleFn:function(e){t.refreshFn()}},{name:"create",icon:"el-icon-edit-outline",title:"添加",handleFn:function(){t.title="添加录像计划";var e=t.jtree.getActive().siteId;Service.listDeviceWithoutPlan({siteId:e}).then(function(n){n.items.storages.length>0?t.dialog.open({siteId:e}):t.$message.error("请先添加存储服务器，再设置录像计划")})}}],listenerWidth:"160px",listeners:[{name:"delete",icon:"icon icon-start",title:"启动",showFn:function(){return 1==$.db.getBJVMS()},handleFn:function(e){var n=e.siteId,i=e.id;Service.startPlan({siteId:n,id:i}).then(function(){return t.$message.success("操作成功")})}},{name:"delete",icon:"icon icon-stop",title:"停止",showFn:function(){return 1==$.db.getBJVMS()},handleFn:function(e){var n=e.siteId,i=e.id;t.$confirm("确认停止此录像计划吗？","提示",{type:"warning"}).then(function(){Service.stopPlan({id:i,siteId:n}).then(function(){return t.$message.success("操作成功")})},function(){t.$message.warning("操作取消")})}},{name:"edit",icon:"el-icon-edit",title:"编辑",handleFn:function(e){var n=t.jtree.getActive().siteId;t.title="编辑录像计划",t.dialog.open({siteId:n,id:e.id})}},{name:"delete",icon:"el-icon-delete",title:"删除",handleFn:function(e){t.delFn(e)}}],column:[{type:"index",name:"序号",width:"60",minWidth:"50"},{key:"name",name:"录像计划名称",width:120,sortable:!0},{key:"days",name:"日期计划",width:150,format:function(t){return"all"==t?"全周":$.db.getFinal().days.list.filter(function(e){return JSON.parse(t).indexOf(Number(l()(e)[0]))>-1}).map(function(t){return o()(t)[0]}).join("，")}},{key:"streamMode",name:"取流方式",width:120,format:function(t){return $.v2str("streamMode",t)}},{key:"circle",name:"存储周期",width:120,format:function(t){return t+"天"}},{key:"timeRange",name:"录像时间",format:function(t,e){var n=e.row;return n.from+" - "+n.to}},{key:"storageName",name:"存储服务器名称",minWidth:120}],ajax:{init:function(e){var n=a()({},e,t.filter);return Service.listPlan(n).then(function(t){return t})}}},expandColumn:[{prop:"id",name:"摄像机ID",width:120},{prop:"name",name:"摄像机名称",width:150},{prop:"deviceSubType",name:"摄像机类型",width:120,format:function(t,e){var n=t.deviceSubType;return'<i class="icon icon-Camera-'+n+'"></i>'+$.v2str("cameraType",n)}},{prop:"zoneName",name:"所属分区",width:120},{prop:"mappingId",name:"编号",format:function(t,e){return Util.isEmptyFn(e)?"--":e}},{prop:"gbId",name:"国标编号",format:function(t,e){return Util.isEmptyFn(e)?"--":e}}]}},computed:{jtree:function(){return this.$refs.jtree},jtable:function(){return this.$refs.jtable},dialog:function(){return this.$refs.dialog}},mounted:function(){var t=this;this.jtree.init().then(function(){return t.refreshFn()})},methods:{arraySpanMethod:function(t){t.row,t.column,t.rowIndex;if(8===t.columnIndex)return{rowspan:10,colspan:1}},formatter:function(t){var e=t.deviceSubType;return'<i class="icon icon-Camera-'+e+'" style=""></i>'+$.v2str("cameraType",e)},refreshFn:function(){var t=this.jtree.getActive().siteId;a()(this.filter,{siteId:t}),this.jtable.init()},delFn:function(t){var e=this,n=this.jtree.getActive().siteId;this.$confirm("确认要删除这个录像计划吗？","提示",{type:"warning"}).then(function(){Service.delPlan({id:t.id,siteId:n}).then(function(){e.$message.success("操作成功"),e.jtree.init().then(function(){return e.query()})})},function(){return e.$message.warning("操作取消")})}}},A=(n("CbuI"),Object(v.a)(k,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"page-store clearfix"},[n("div",{staticClass:"store-tree fl"},[n("nv-tree",{ref:"jtree",attrs:{setting:t.treeSetting}})],1),t._v(" "),n("div",{staticClass:"store-list fl"},[n("nv-table",{ref:"jtable",attrs:{setting:t.gridConfig},scopedSlots:t._u([{key:"expandTpl",fn:function(e){return n("div",{staticClass:"expand-tpl"},[n("el-table",{staticStyle:{width:"99%"},attrs:{data:e.info.cameras,"span-method":t.arraySpanMethod,height:"198"}},[n("el-table-column",{attrs:{type:"index",label:"#",width:"60",align:"center"}}),t._v(" "),t._l(t.expandColumn,function(e){return n("el-table-column",{key:e.prop,attrs:{prop:e.prop,label:e.name,width:e.width,sortable:e.sortable,align:"center","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(i){return[n("span",{domProps:{innerHTML:t._s(e.format?e.format(i.row,i.row[e.prop]):i.row[e.prop])}})]}}])})}),t._v(" "),n("el-table-column",{attrs:{label:"总数 ："+e.info.cameras.length,prop:"",align:"center"}})],2)],1)}}])})],1),t._v(" "),n("edit-form",{ref:"dialog",attrs:{title:t.title}})],1)},[],!1,null,null,null));A.options.__file="index.vue";e.default=A.exports},jko9:function(t,e,n){"use strict";var i=n("9oRo");n.n(i).a},kKWf:function(t,e,n){"use strict";var i=n("Gd76"),a=n.n(i);e.a={data:function(){return{downLoading:!1}},methods:{timeRangeChangeFn:function(){var t=this.filter.timeRange,e=[$.getCurDay().from,$.getCurDay().to];return $.isEmptyFn(t)?this.filter.timeRange=["",""]:this.filter.timeRange.every(function(t){return 0==t})?this.filter.timeRange=e:this.filter.timeRange=this.filter.timeRange.map(function(t){return t instanceof Date?$.Date.getTickInSec(t):t})},clearFilter:function(t,e){for(var n in this.filter)this.filter[n]="timeRange"==n?[$.getCurDay().from,$.getCurDay().to]:t&&t[n]||"";e&&e()},query:function(){var t=this;this.jtable.clear(function(){t.jtable.init()})},download:function(t,e){var n=this;this.downLoading=!0,Service[t](e||this.filter).then(function(t){n.downLoading=!1;var e=t.headers["content-disposition"],i=decodeURI(e.match(/filename=(.*)/)[1],"UTF-8");a()(t.data,i)})}}}},uGIX:function(t,e,n){"use strict";var i=n("VAIr");n.n(i).a},uV9B:function(t,e,n){"use strict";var i=n("gDS+"),a=n.n(i),r=n("4d7F"),o=n.n(r);e.a={data:function(){return{tab:"first",gbOption:{}}},methods:{getFirstForm:function(){return this.$refs.formFactory.$refs.form},getSecondForm:function(){return this.$refs.gbFormFactory.$refs.form},validateFirst:function(t,e,n){var i=this;return new o.a(function(t,e){i.getFirstForm().validateTabForm(function(e,n){t(e)},n)})},validateSecond:function(t,e,n){var i=this;return new o.a(function(t,e){i.getSecondForm().validate(function(e,n){t(e)},!1)})},getSecondFormValue:function(t){var e=this,n={};return this.gbFields.forEach(function(t){if(t.name&&(!t.show||t.show())){var i=e.model[t.name];n[t.name]=i}}),{gb28181:a()(n)}},submit:function(t){var e=this;"first"==this.tab?o.a.all([this.validateFirst()]).then(function(t){t[0]&&e.saveAjax()}):o.a.all([this.validateFirst(),this.validateSecond()]).then(function(t){return t[0]||t[1]?t[0]?t[1]?void(t[0]&&t[1]&&e.saveAjax()):e.nvMsg("请确认国标配置","warning"):e.nvMsg("请确认基础配置","warning"):e.nvMsg("请确认基础配置、国标配置","warning")})},closeEvent:function(){this.tab="first"}}}},xVR9:function(t,e,n){}}]);